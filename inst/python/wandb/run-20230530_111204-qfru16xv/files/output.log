/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/haiku/_src/data_structures.py:143: FutureWarning: jax.tree_flatten is deprecated, and will be removed in a future release. Use jax.tree_util.tree_flatten instead.
  leaves, treedef = jax.tree_flatten(tree)
/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/haiku/_src/data_structures.py:144: FutureWarning: jax.tree_unflatten is deprecated, and will be removed in a future release. Use jax.tree_util.tree_unflatten instead.
  return jax.tree_unflatten(treedef, leaves)
epoch done with 1.093
epoch done with 0.995
epoch done with 0.912
epoch done with 0.839
epoch done with 0.776
epoch done with 0.722
epoch done with 0.676
epoch done with 0.637
epoch done with 0.603
epoch done with 0.574
epoch done with 0.550
epoch done with 0.527
epoch done with 0.508
epoch done with 0.490
epoch done with 0.474
epoch done with 0.459
epoch done with 0.445
epoch done with 0.433
epoch done with 0.422
epoch done with 0.411
epoch done with 0.401
epoch done with 0.392
epoch done with 0.382
epoch done with 0.373
epoch done with 0.365
epoch done with 0.356
epoch done with 0.346
epoch done with 0.335
epoch done with 0.324
epoch done with 0.312
epoch done with 0.301
epoch done with 0.290
epoch done with 0.279
epoch done with 0.268
epoch done with 0.256
epoch done with 0.243
epoch done with 0.229
epoch done with 0.213
epoch done with 0.197
epoch done with 0.184
epoch done with 0.173
epoch done with 0.165
epoch done with 0.159
epoch done with 0.155
epoch done with 0.151
epoch done with 0.148
epoch done with 0.146
epoch done with 0.144
epoch done with 0.142
epoch done with 0.141
epoch done with 0.140
epoch done with 0.139
epoch done with 0.138
epoch done with 0.137
epoch done with 0.137
epoch done with 0.136
epoch done with 0.135
epoch done with 0.135
epoch done with 0.134
epoch done with 0.134
epoch done with 0.133
epoch done with 0.133
epoch done with 0.133
epoch done with 0.132
epoch done with 0.132
epoch done with 0.132
epoch done with 0.131
epoch done with 0.131
epoch done with 0.131
epoch done with 0.131
epoch done with 0.131
epoch done with 0.130
epoch done with 0.130
epoch done with 0.130
epoch done with 0.130
Grid search using {'num_samples': 128, 'learning_rate': 0.0001, 'l1_regularization_factor': 0.0001, 'l2_regularization_factor': 0.001, 'number_additive_traits': 1, 'model_type': 'tri_state_non_equilibrium_implicit'}
epoch done with 0.726
epoch done with 0.685
epoch done with 0.648
epoch done with 0.616
epoch done with 0.589
epoch done with 0.566
epoch done with 0.546
epoch done with 0.528
epoch done with 0.511
epoch done with 0.496
epoch done with 0.482
epoch done with 0.469
epoch done with 0.457
epoch done with 0.445
epoch done with 0.434
epoch done with 0.424
epoch done with 0.414
epoch done with 0.404
epoch done with 0.394
epoch done with 0.384
epoch done with 0.373
epoch done with 0.361
epoch done with 0.349
epoch done with 0.338
epoch done with 0.328
epoch done with 0.320
epoch done with 0.313
epoch done with 0.307
epoch done with 0.302
epoch done with 0.298
epoch done with 0.295
epoch done with 0.292
epoch done with 0.288
epoch done with 0.284
epoch done with 0.278
epoch done with 0.270
epoch done with 0.261
epoch done with 0.251
epoch done with 0.240
epoch done with 0.228
epoch done with 0.217
epoch done with 0.206
epoch done with 0.196
epoch done with 0.187
epoch done with 0.180
epoch done with 0.174
epoch done with 0.169
epoch done with 0.165
epoch done with 0.162
epoch done with 0.159
epoch done with 0.157
epoch done with 0.155
epoch done with 0.153
Traceback (most recent call last):
  File "pierre_mochi__fit_tmodel_3state_doubledeepms.py", line 180, in <module>
    grid_results = [fit_model_grid_jax(params, model_data_jax, num_epochs_grid, rng_key, wandb_config) for params, rng_key in zip(parameter_grid, rngs_grid)]
  File "pierre_mochi__fit_tmodel_3state_doubledeepms.py", line 180, in <listcomp>
    grid_results = [fit_model_grid_jax(params, model_data_jax, num_epochs_grid, rng_key, wandb_config) for params, rng_key in zip(parameter_grid, rngs_grid)]
  File "/Users/pierredemetz/UCL_work/Crick/doubledeepms/inst/python/training.py", line 136, in fit_model_grid_jax
    weights, opt_state = update(weights, opt_state, inputs_select, inputs_folding, inputs_binding, target)
  File "/Users/pierredemetz/UCL_work/Crick/doubledeepms/inst/python/utils.py", line 72, in apply_weight_constraints
    constrained_params[layer_name]['w'] = jnp.clip(constrained_params[layer_name]['w'], min_val, max_val)
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/traceback_util.py", line 163, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/pjit.py", line 237, in cache_miss
    outs, out_flat, out_tree, args_flat = _python_pjit_helper(
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/pjit.py", line 185, in _python_pjit_helper
    out_flat = pjit_p.bind(*args_flat, **params)
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/core.py", line 2555, in bind
    axis_main = max((axis_frame(a).main_trace for a in used_axis_names(self, params)),
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/core.py", line 2459, in used_axis_names
    subst_axis_names(primitive, params, subst)
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/core.py", line 2478, in subst_axis_names
    new_params[name] = subst_axis_names_jaxpr(jaxpr, shadowed_subst)
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/core.py", line 2534, in subst_axis_names_jaxpr
    subst.axis_names |= used_axis_names_jaxpr(jaxpr)
  File "/Users/pierredemetz/miniconda3/envs/pierre/lib/python3.8/site-packages/jax/_src/config.py", line 464, in _trace_context
    tls = jax_jit.thread_local_state()
KeyboardInterrupt